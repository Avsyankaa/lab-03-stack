os: linux

language: cpp
sudo: false

addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - libstdc++-7-dev
    - g++-7
    update: true

env: CC_EVAL=gcc-7 CXX_EVAL=g++-7

before_install:
  - export CXX=${CXX_EVAL}
  - export CC=${CC_EVAL}

script:
- chmod 777 ./cpplint.py
- ( for file in $(find ./ -name "*.cpp"); do ./cpplint.py $file || exit; done );
# https://stackoverflow.com/questions/50024731/ld-unrecognized-option-push-state-no-as-needed
- export CMAKE_PARAMETERS=CMAKE_EXE_LINKER="-fuse-ld=gold" CMAKE_EXPORT_COMPILE_COMMANDS=ON
- ./polly/bin/polly --toolchain sanitize-address --config Release --output builds --fwd ${CMAKE_PARAMETERS}
- ( for file in $(find ./tests -name "*.cpp"); do echo $file; clang-check -analyze $file -p builds || exit; done );
- ./polly/bin/polly --test

notifications:
  email: false
